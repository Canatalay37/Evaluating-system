<!doctype html>
<html>
<head>
<title>Question Points</title>
<style>
body { font-family: Arial, sans-serif; margin: 20px; }
form { background: #f5f5f5; padding: 20px; border-radius: 8px; }
input[type="number"] { padding: 8px; margin: 2px; border: 1px solid #ddd; border-radius: 4px; width: 80px; }
input[type="submit"] { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin-top: 20px; }
.exam-section { background: white; padding: 15px; margin: 10px 0; border-radius: 5px; border: 1px solid #ddd; }
.question-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; }
</style>
</head>
<body>
<h2>Question Points</h2>
{% if students_per_exam %}
  <div style="margin-bottom:10px;color:#555;">
    {% for exam_idx, exam in enumerate(exams) %}
      <div>
        <strong>{{ exam['name'] }}</strong>: Students = {{ students_per_exam[exam_idx] if exam_idx < students_per_exam|length else 'N/A' }}
      </div>
    {% endfor %}
  </div>
{% endif %}
<form method="post" id="qpForm">
  {% for exam_idx, exam in enumerate(exams) %}
    <div class="exam-section">
      <h3>{{ exam['name'] }}</h3>
      <div class="question-grid">
        {% for q in range(exam['question_count']|int) %}
          <div style="border:1px solid #eee; border-radius:4px; padding:8px; margin-bottom:8px; background:#fafbfc;">
            <label>Soru {{ q+1 }} Puanı:
              <input type="number" name="points_{{exam_idx}}_{{q}}" min="0" max="100" required>
            </label><br>
            <div style="margin:6px 0;">
              <div style="font-weight:600; margin-bottom:4px;">CLO Seçimi:</div>
              <div style="display:grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap:6px; align-items:center;">
                {% for idx in range(clo_count) %}
                  <label style="display:flex; gap:8px; align-items:center; background:#fff; border:1px solid #eee; padding:4px 6px; border-radius:4px;">
                    <input type="checkbox" name="clo_{{exam_idx}}_{{q}}" value="{{ idx + 1 }}">
                    <span>{{ clo_names[idx] if clo_names and idx < clo_names|length else ('CLO ' ~ (idx + 1)) }}</span>
                  </label>
                {% endfor %}
              </div>
            </div>
            <label>QCT (%):
              <input type="number" name="qct_{{exam_idx}}_{{q}}" min="0" max="100" step="0.01" required>
            </label><br>
            <label>BL:
              <input type="number" name="bl_{{exam_idx}}_{{q}}" min="1" max="6" step="0.1" required>
            </label>
          </div>
        {% endfor %}
      </div>
    </div>
  {% endfor %}
  <div style="margin-top:8px;color:#666;">Her sınav içindeki soru puanlarının toplamı 100 olmalıdır.</div>
  <input type="submit" value="Kaydet ve Devam Et">
</form>
<script>
// Her sınavın soru puanları toplamı 100 olmalı
document.getElementById('qpForm').addEventListener('submit', function(e) {
  const examSections = Array.from(document.querySelectorAll('.exam-section'));
  for (let examIdx = 0; examIdx < examSections.length; examIdx++) {
    const inputs = examSections[examIdx].querySelectorAll('input[name^="points_' + examIdx + '_"]');
    let sum = 0;
    inputs.forEach(inp => { const v = parseFloat(inp.value || '0'); if (!isNaN(v)) sum += v; });
    if (sum !== 100) {
      e.preventDefault();
      alert(`"${document.querySelectorAll('.exam-section h3')[examIdx].textContent}" için soru puanları toplamı ${sum}. Toplam 100 olmalı.`);
      return false;
    }
  }
});
</script>
<hr style="margin-top:32px;">
<div style="max-width:700px; margin:auto;">
  <h3>Bloom Level Bilgilendirme Tablosu</h3>
  <table border="1" cellpadding="6" cellspacing="0" style="width:100%; border-collapse:collapse; text-align:center;">
    <tr style="background:#f5f5f5; font-weight:bold;">
      <th>BL</th>
      <th>Bloom Level</th>
      <th>Cognitive Action Verbs</th>
    </tr>
    <tr>
      <td>1</td>
      <td>Remember</td>
      <td>Define, list, name, identify, recall</td>
    </tr>
    <tr>
      <td>2</td>
      <td>Understand</td>
      <td>Explain, describe, summarize, classify, interpret</td>
    </tr>
    <tr>
      <td>3</td>
      <td>Apply</td>
      <td>Use, calculate, demonstrate, solve, implement</td>
    </tr>
    <tr>
      <td>4</td>
      <td>Analyze/Evaluate/Create</td>
      <td>Analyze, compare, justify, critique, design, develop, construct</td>
    </tr>
  </table>
</div>
</body>
</html>