<!doctype html>
<html>
<head>
    <title>Bloom Level & CLO Analysis</title>
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            margin: 20px; 
            font-size: 11px;
            background-color: #f8f9fa;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        /* Formula Section */
        .formula-section {
            margin-top: 30px;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }
        .formula-title {
            font-size: 14px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        /* Button */
        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        .submit-btn, .download-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            color: white;
            display: inline-block;
        }
        .submit-btn {
            background: linear-gradient(135deg, #27ae60, #229954);
        }
        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(39, 174, 96, 0.3);
        }
        .download-btn {
            background: #007bff;
        }
        .download-btn:hover {
            background: #0056b3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);
        }

        /* Information Tables Styles */
        .info-section {
            margin-top: 40px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }
        .info-table-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-left: 4px solid #6c5ce7;
        }
        .info-table-title {
            font-size: 14px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 15px;
            text-align: center;
        }
        .info-table {
            border-collapse: collapse;
            width: 100%;
            font-size: 11px;
        }
        .info-table th, .info-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
            vertical-align: top;
        }
        .info-table th {
            background: linear-gradient(135deg, #6c5ce7, #5a4fcf);
            color: white;
            font-weight: bold;
            text-align: center;
        }
        .info-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        .info-table tr:hover {
            background-color: #e9ecef;
        }
        .bl-level {
            font-weight: bold;
            color: #6c5ce7;
            text-align: center;
        }
        
        /* Responsive adjustments */
        @media (max-width: 1200px) {
            body { font-size: 10px; }
            .info-section {
                grid-template-columns: 1fr;
                gap: 20px;
            }
        }
        
        /* Jinja2 Template Styles - CSS Validator may show errors for these */
        /* These are dynamic styles that use Jinja2 template variables */
    </style>
</head>
<body>
    <div class="container">
        <h2>Bloom Level & CLO Analysis</h2>
        
        <!-- Course Information Display -->
        <div style="background: rgba(102, 126, 234, 0.1); border: 1px solid rgba(102, 126, 234, 0.3); border-radius: 10px; padding: 15px; margin-bottom: 20px; backdrop-filter: blur(5px);">
            <h3 style="color: #667eea; font-size: 1.1rem; margin-bottom: 10px; font-weight: 600;">📚 Course Information</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                <div style="display: flex; flex-direction: column;">
                    <span style="font-size: 0.85rem; color: #6c757d; font-weight: 500; margin-bottom: 2px;">Course Code:</span>
                    <span style="font-size: 1rem; color: #2c3e50; font-weight: 600;">{{ session.get('course_code', 'N/A') }}</span>
                </div>
                <div style="display: flex; flex-direction: column;">
                    <span style="font-size: 0.85rem; color: #6c757d; font-weight: 500; margin-bottom: 2px;">Teacher:</span>
                    <span style="font-size: 1rem; color: #2c3e50; font-weight: 600;">{{ session.get('teacher_name', 'N/A') }}</span>
                </div>
                <div style="display: flex; flex-direction: column;">
                    <span style="font-size: 0.85rem; color: #6c757d; font-weight: 500; margin-bottom: 2px;">Semester:</span>
                    <span style="font-size: 1rem; color: #2c3e50; font-weight: 600;">{{ session.get('semester', 'N/A') }}</span>
                </div>
            </div>
        </div>

        <!-- CLO Analysis Results Table -->
        <div class="formula-section">
            <div class="formula-title">📊 CLO Analysis Results</div>
            <table style="width: 100%; margin-top: 15px;">
                <thead>
                    <tr>
                        <th style="background: linear-gradient(135deg, #6f42c1, #5a2d91); color: white; padding: 10px;">CLO</th>
                        <th style="background: linear-gradient(135deg, #ffc107, #e0a800); color: black; padding: 10px;">Normalized CLO %</th>
                        <th style="background: linear-gradient(135deg, #fd7e14, #e8590c); color: white; padding: 10px;">Average Bloom Level-CLO</th>
                        <th style="background: linear-gradient(135deg, #20c997, #17a2b8); color: white; padding: 10px;">Student Performance Assessment</th>
                        <th style="background: linear-gradient(135deg, #dc3545, #bd2130); color: white; padding: 10px;">Recommended Instructor Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for clo_idx in range(clos|length) %}
                        {% set normalized_clo = ((clo_results[clo_idx]['weighted_clo_score'] / clo_results[clo_idx]['max_clo_score']) * 100) if clo_results and clo_idx < clo_results|length and clo_results[clo_idx]['max_clo_score'] > 0 else 0 %}
                        {% set avg_bloom_level = clo_results[clo_idx]['average_bloom_score'] if clo_results and clo_idx < clo_results|length and clo_results[clo_idx]['average_bloom_score'] > 0 else 0 %}
                        
                        {# Alt tablolardaki aralıklara göre performance ve recommendation belirleme #}
                        {% if normalized_clo >= 85 and avg_bloom_level > 3.0 %}
                            {% set performance_color = "#28a745" %}
                            {% set performance_text = "Excellent mastery with deep, higher-order thinking" %}
                            {% set recommendation_text = "Maintain teaching and assessment strategy; consider sharing as best practice" %}
                        {% elif normalized_clo >= 85 and avg_bloom_level >= 2 and avg_bloom_level <= 3 %}
                            {% set performance_color = "#28a745" %}
                            {% set performance_text = "Excellent mastery, but mostly mid-level cognitive tasks" %}
                            {% set recommendation_text = "Improve assessment depth (add BL 4 questions) while retaining core approach" %}
                        {% elif normalized_clo >= 85 and avg_bloom_level < 2 %}
                            {% set performance_color = "#ffc107" %}
                            {% set performance_text = "Superficial mastery — strong scores from low-level tasks" %}
                            {% set recommendation_text = "Replace low-level assessments with tasks that demand higher-order thinking" %}
                        {% elif normalized_clo >= 70 and normalized_clo < 85 and avg_bloom_level > 3.0 %}
                            {% set performance_color = "#28a745" %}
                            {% set performance_text = "Strong achievement with rich cognitive engagement" %}
                            {% set recommendation_text = "Maintain rigor; consider refining support strategies for students" %}
                        {% elif normalized_clo >= 70 and normalized_clo < 85 and avg_bloom_level >= 2 and avg_bloom_level <= 3 %}
                            {% set performance_color = "#28a745" %}
                            {% set performance_text = "Strong results with balanced cognitive challenge" %}
                            {% set recommendation_text = "Introduce more Bloom Level 3+ tasks to push students beyond procedural skills" %}
                        {% elif normalized_clo >= 70 and normalized_clo < 85 and avg_bloom_level < 2 %}
                            {% set performance_color = "#ffc107" %}
                            {% set performance_text = "Strong scores with limited depth — risk of over-simplification" %}
                            {% set recommendation_text = "Shift from recall-based to application/analysis-type questions" %}
                        {% elif normalized_clo >= 50 and normalized_clo < 70 and avg_bloom_level > 3.0 %}
                            {% set performance_color = "#ffc107" %}
                            {% set performance_text = "Moderate learning with challenging conditions" %}
                            {% set recommendation_text = "Offer better scaffolding and conceptual clarity to help students succeed" %}
                        {% elif normalized_clo >= 50 and normalized_clo < 70 and avg_bloom_level >= 2 and avg_bloom_level <= 3 %}
                            {% set performance_color = "#28a745" %}
                            {% set performance_text = "Moderate achievement with routine or procedural learning" %}
                            {% set recommendation_text = "Revise both instruction and question difficulty for alignment" %}
                        {% elif normalized_clo >= 50 and normalized_clo < 70 and avg_bloom_level < 2 %}
                            {% set performance_color = "#ffc107" %}
                            {% set performance_text = "Basic understanding with very limited thinking depth" %}
                            {% set recommendation_text = "Redesign instruction and assessments to encourage deep learning" %}
                        {% elif normalized_clo < 50 and avg_bloom_level > 3.0 %}
                            {% set performance_color = "#dc3545" %}
                            {% set performance_text = "Poor achievement on cognitively rich tasks" %}
                            {% set recommendation_text = "Strengthen foundational teaching and reinforce cognitive scaffolding" %}
                        {% elif normalized_clo < 50 and avg_bloom_level >= 2 and avg_bloom_level <= 3 %}
                            {% set performance_color = "#28a745" %}
                            {% set performance_text = "Low achievement with moderate-level assessment" %}
                            {% set recommendation_text = "Increase student support; revisit topic sequencing, and practice opportunities" %}
                        {% elif normalized_clo < 50 and avg_bloom_level < 2 %}
                            {% set performance_color = "#dc3545" %}
                            {% set performance_text = "Critical learning failure — performance and rigor are both weak" %}
                            {% set recommendation_text = "Full instructional and assessment redesign needed — priority for improvement" %}
                        {% else %}
                            {% set performance_color = "#6c757d" %}
                            {% set performance_text = "No data available for assessment" %}
                            {% set recommendation_text = "Please ensure all data is properly entered" %}
                        {% endif %}
                        
                        <tr{% if loop.index0 % 2 == 0 %} style="background-color: #f8f9fa;"{% endif %}>
                            <td style="font-weight: bold; color: #6f42c1; padding: 8px;">
                                {{ clo_names[clo_idx] if clo_names and clo_idx < clo_names|length else 'CLO ' ~ (clo_idx + 1) }}
                            </td>
                            <td style="background-color: {{ performance_color }}; color: {% if performance_color == '#ffc107' %}black{% else %}white{% endif %}; font-weight: bold; padding: 8px;">
                                {{ "%.2f"|format(normalized_clo) }}%
                            </td>
                            <td style="background-color: {{ performance_color }}; color: {% if performance_color == '#ffc107' %}black{% else %}white{% endif %}; font-weight: bold; padding: 8px;">
                                {{ "%.2f"|format(avg_bloom_level) }}
                            </td>
                            <td style="background-color: {{ performance_color }}; color: {% if performance_color in ['#ffc107'] %}black{% else %}white{% endif %}; font-weight: bold; padding: 8px; border-radius: 4px;">
                                {{ performance_text }}
                            </td>
                            <td style="background-color: {{ performance_color }}; color: {% if performance_color in ['#ffc107'] %}black{% else %}white{% endif %}; font-weight: bold; padding: 8px; border-radius: 4px;">
                                {{ recommendation_text }}
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>



        <!-- Information Tables Section -->
        <div class="info-section">
            <!-- Student Performance Interpretation Table -->
            <div class="info-table-container">
                <div class="info-table-title">📊 Student Performance Interpretation</div>
                <table class="info-table">
                    <thead>
                        <tr>
                            <th style="width: 20%;">Normalized CLO Score</th>
                            <th style="width: 25%;">Normalized Bloom Score</th>
                            <th style="width: 55%;">Student Performance Interpretation</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="background-color: #d4edda;">
                            <td style="text-align: center;">≥ 85</td>
                            <td style="text-align: center;">> 3.0</td>
                            <td style="background-color: #28a745; color: white; font-weight: bold; padding: 8px; border-radius: 4px;">Excellent mastery with deep, higher-order thinking</td>
                        </tr>
                        <tr style="background-color: #d4edda;">
                            <td style="text-align: center;">≥ 85</td>
                            <td style="text-align: center;">2-3</td>
                            <td style="background-color: #28a745; color: white; font-weight: bold; padding: 8px; border-radius: 4px;">Excellent mastery, but mostly mid-level cognitive tasks</td>
                        </tr>
                        <tr>
                            <td style="text-align: center;">≥ 85</td>
                            <td style="text-align: center;">< 2</td>
                            <td style="background-color: #ffc107; color: black; font-weight: bold; padding: 8px; border-radius: 4px;">Superficial mastery — strong scores from low-level tasks</td>
                        </tr>
                        <tr style="background-color: #d4edda;">
                            <td style="text-align: center;">70-85</td>
                            <td style="text-align: center;">> 3.0</td>
                            <td style="background-color: #28a745; color: white; font-weight: bold; padding: 8px; border-radius: 4px;">Strong achievement with rich cognitive engagement</td>
                        </tr>
                        <tr style="background-color: #d4edda;">
                            <td style="text-align: center;">70-85</td>
                            <td style="text-align: center;">2-3</td>
                            <td style="background-color: #28a745; color: white; font-weight: bold; padding: 8px; border-radius: 4px;">Strong results with balanced cognitive challenge</td>
                        </tr>
                        <tr>
                            <td style="text-align: center;">70-85</td>
                            <td style="text-align: center;">< 2</td>
                            <td style="background-color: #ffc107; color: black; font-weight: bold; padding: 8px; border-radius: 4px;">Strong scores with limited depth — risk of over-simplification</td>
                        </tr>
                        <tr style="background-color: #fff3cd;">
                            <td style="text-align: center;">50-70</td>
                            <td style="text-align: center;">> 3.0</td>
                            <td style="background-color: #ffc107; color: black; font-weight: bold; padding: 8px; border-radius: 4px;">Moderate learning with challenging conditions</td>
                        </tr>
                        <tr style="background-color: #d4edda;">
                            <td style="text-align: center;">50-70</td>
                            <td style="text-align: center;">2-3</td>
                            <td style="background-color: #28a745; color: white; font-weight: bold; padding: 8px; border-radius: 4px;">Moderate achievement with routine or procedural learning</td>
                        </tr>
                        <tr>
                            <td style="text-align: center;">50-70</td>
                            <td style="text-align: center;">< 2</td>
                            <td style="background-color: #ffc107; color: black; font-weight: bold; padding: 8px; border-radius: 4px;">Basic understanding with very limited thinking depth</td>
                        </tr>
                        <tr>
                            <td style="text-align: center;">< 50</td>
                            <td style="text-align: center;">> 3.0</td>
                            <td style="background-color: #dc3545; color: white; font-weight: bold; padding: 8px; border-radius: 4px;">Poor achievement on cognitively rich tasks</td>
                        </tr>
                        <tr style="background-color: #d4edda;">
                            <td style="text-align: center;">< 50</td>
                            <td style="text-align: center;">2-3</td>
                            <td style="background-color: #28a745; color: white; font-weight: bold; padding: 8px; border-radius: 4px;">Low achievement with moderate-level assessment</td>
                        </tr>
                        <tr style="background-color: #f8d7da;">
                            <td style="text-align: center;">< 50</td>
                            <td style="text-align: center;">< 2</td>
                            <td style="background-color: #dc3545; color: white; font-weight: bold; padding: 8px; border-radius: 4px;">Critical learning failure — performance and rigor are both weak</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Recommended Instructor Action Table -->
            <div class="info-table-container">
                <div class="info-table-title">🎯 Recommended Instructor Action</div>
                <table class="info-table">
                    <thead>
                        <tr>
                            <th style="width: 20%;">Normalized CLO Score</th>
                            <th style="width: 25%;">Normalized Bloom Score</th>
                            <th style="width: 55%;">Recommended Instructor Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td style="text-align: center;">≥ 85</td>
                            <td style="text-align: center;">> 3.0</td>
                            <td style="background-color: #28a745; color: white; font-weight: bold; padding: 8px; border-radius: 4px;">Maintain teaching and assessment strategy; consider sharing as best practice</td>
                        </tr>
                        <tr>
                            <td style="text-align: center;">≥ 85</td>
                            <td style="text-align: center;">2-3</td>
                            <td style="background-color: #28a745; color: white; font-weight: bold; padding: 8px; border-radius: 4px;">Improve assessment depth (add BL 4 questions) while retaining core approach</td>
                        </tr>
                        <tr>
                            <td style="text-align: center;">≥ 85</td>
                            <td style="text-align: center;">< 2</td>
                            <td style="background-color: #ffc107; color: black; font-weight: bold; padding: 8px; border-radius: 4px;">Replace low-level assessments with tasks that demand higher-order thinking</td>
                        </tr>
                        <tr>
                            <td style="text-align: center;">70-85</td>
                            <td style="text-align: center;">> 3.0</td>
                            <td style="background-color: #28a745; color: white; font-weight: bold; padding: 8px; border-radius: 4px;">Maintain rigor; consider refining support strategies for students</td>
                        </tr>
                        <tr>
                            <td style="text-align: center;">70-85</td>
                            <td style="text-align: center;">2-3</td>
                            <td style="background-color: #28a745; color: white; font-weight: bold; padding: 8px; border-radius: 4px;">Introduce more Bloom Level 3+ tasks to push students beyond procedural skills</td>
                        </tr>
                        <tr>
                            <td style="text-align: center;">70-85</td>
                            <td style="text-align: center;">< 2</td>
                            <td style="background-color: #ffc107; color: black; font-weight: bold; padding: 8px; border-radius: 4px;">Shift from recall-based to application/analysis-type questions</td>
                        </tr>
                        <tr>
                            <td style="text-align: center;">50-70</td>
                            <td style="text-align: center;">> 3.0</td>
                            <td style="background-color: #ffc107; color: black; font-weight: bold; padding: 8px; border-radius: 4px;">Offer better scaffolding and conceptual clarity to help students succeed</td>
                        </tr>
                        <tr>
                            <td style="text-align: center;">50-70</td>
                            <td style="text-align: center;">2-3</td>
                            <td style="background-color: #28a745; color: white; font-weight: bold; padding: 8px; border-radius: 4px;">Revise both instruction and question difficulty for alignment</td>
                        </tr>
                        <tr>
                            <td style="text-align: center;">50-70</td>
                            <td style="text-align: center;">< 2</td>
                            <td style="background-color: #ffc107; color: black; font-weight: bold; padding: 8px; border-radius: 4px;">Redesign instruction and assessments to encourage deep learning</td>
                        </tr>
                        <tr>
                            <td style="text-align: center;">< 50</td>
                            <td style="text-align: center;">> 3.0</td>
                            <td style="background-color: #dc3545; color: white; font-weight: bold; padding: 8px; border-radius: 4px;">Strengthen foundational teaching and reinforce cognitive scaffolding</td>
                        </tr>
                        <tr>
                            <td style="text-align: center;">< 50</td>
                            <td style="text-align: center;">2-3</td>
                            <td style="background-color: #28a745; color: white; font-weight: bold; padding: 8px; border-radius: 4px;">Increase student support; revisit topic sequencing, and practice opportunities</td>
                        </tr>
                        <tr>
                            <td style="text-align: center;">< 50</td>
                            <td style="text-align: center;">< 2</td>
                            <td style="background-color: #dc3545; color: white; font-weight: bold; padding: 8px; border-radius: 4px;">Full instructional and assessment redesign needed — priority for improvement</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Download All Tables Button -->
        <div class="btn-group" style="margin-top: 20px; text-align: center;">
            <a href="/download_all_tables" class="submit-btn" style="background-color: #28a745;">📥 Tüm Tabloları İndir (CSV)</a>
        </div>

        <!-- Navigation Buttons -->
        <div class="btn-group" style="margin-top: 30px; text-align: center;">
            <a href="/student_grades" class="submit-btn" style="background-color: #6c757d;">← Back to Student Grades</a>
            <a href="/summary" class="submit-btn" style="background-color: #007bff;">← Back to Summary</a>
        </div>

    </div>
</body>
</html>
