<!doctype html>
<html>
<head>
    <title>Bloom Level & CLO Analysis</title>
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            margin: 20px; 
            font-size: 11px;
            background-color: #f8f9fa;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        /* Formula Section */
        .formula-section {
            margin-top: 30px;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }
        .formula-title {
            font-size: 14px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        /* Button */
        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        .submit-btn, .download-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            color: white;
            display: inline-block;
        }
        .submit-btn {
            background: linear-gradient(135deg, #27ae60, #229954);
        }
        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(39, 174, 96, 0.3);
        }
        .download-btn {
            background: #007bff;
        }
        .download-btn:hover {
            background: #0056b3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);
        }

        .perf-green { background-color: #28a745; color: white; }
        .perf-yellow { background-color: #ffc107; color: black; }
        .perf-orange { background-color: #fd7e14; color: black; }
        .perf-red { background-color: #dc3545; color: white; }
        .perf-gray { background-color: #6c757d; color: white; }
        .perf-cell { font-weight: bold; padding: 8px; border-radius: 4px; }

        /* Information Tables Styles - Removed as tables are now hidden */
        .bl-level {
            font-weight: bold;
            color: #6c5ce7;
            text-align: center;
        }
        
        /* Responsive adjustments */
        @media (max-width: 1200px) {
            body { font-size: 10px; }
        }
        
        /* Jinja2 Template Styles - CSS Validator may show errors for these */
        /* These are dynamic styles that use Jinja2 template variables */
    </style>
</head>
<body>
    <div class="container">
        <h2>Results & Summary</h2>
        
        <!-- Course Information Display -->
        <div style="background: rgba(102, 126, 234, 0.1); border: 1px solid rgba(102, 126, 234, 0.3); border-radius: 10px; padding: 15px; margin-bottom: 20px; backdrop-filter: blur(5px);">
            <h3 style="color: #667eea; font-size: 1.1rem; margin-bottom: 10px; font-weight: 600;">üìö Course Information</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                <div style="display: flex; flex-direction: column;">
                    <span style="font-size: 0.85rem; color: #6c757d; font-weight: 500; margin-bottom: 2px;">Course Code:</span>
                    <span style="font-size: 1rem; color: #2c3e50; font-weight: 600;">{{ session.get('course_code', 'N/A') }}</span>
                </div>
                <div style="display: flex; flex-direction: column;">
                                            <span style="font-size: 0.85rem; color: #6c757d; font-weight: 500; margin-bottom: 2px;">Instructor:</span>
                    <span style="font-size: 1rem; color: #2c3e50; font-weight: 600;">{{ session.get('teacher_name', 'N/A') }}</span>
                </div>
                <div style="display: flex; flex-direction: column;">
                    <span style="font-size: 0.85rem; color: #6c757d; font-weight: 500; margin-bottom: 2px;">Semester:</span>
                    <span style="font-size: 1rem; color: #2c3e50; font-weight: 600;">{{ session.get('semester', 'N/A') }}</span>
                </div>
            </div>
        </div>

        <!-- CLO Analysis Results Table -->
        <div class="formula-section">
            <div class="formula-title">üìä CLO Analysis Results</div>
            
            <table style="width: 100%; margin-top: 15px;">
                <thead>
                    <tr>
                        <th style="background: linear-gradient(135deg, #6f42c1, #5a2d91); color: white; padding: 10px;">CLO</th>
                        <th style="background: linear-gradient(135deg, #ffc107, #e0a800); color: black; padding: 10px;">Normalized CLO %</th>
                        <th style="background: linear-gradient(135deg, #fd7e14, #e8590c); color: white; padding: 10px;">Average Bloom Level-CLO</th>
                        <th style="background: linear-gradient(135deg, #20c997, #17a2b8); color: white; padding: 10px;">Student Performance Assessment</th>
                        <th style="background: linear-gradient(135deg, #dc3545, #bd2130); color: white; padding: 10px;">Recommended Instructor Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for clo_idx in range(clos|length) %}
                        {% if clo_results and clo_idx < clo_results|length %}
                            {% set clo_result = clo_results[clo_idx] %}
                            
                            {# Debug: CLO result i√ßeriƒüini kontrol et #}
                            <!-- DEBUG: CLO {{ clo_idx + 1 }} - clo_result: {{ clo_result }} -->
                            
                            {# Normalized CLO % - Use the value calculated in Python #}
                            {% set normalized_clo = clo_result.normalized_clo_score %}
                            
                            {# Debug: Normalized CLO deƒüerini kontrol et #}
                            <!-- DEBUG: CLO {{ clo_idx + 1 }} - normalized_clo: {{ normalized_clo }} -->
                            
                            {# Average Bloom Level-CLO = Average Bloom Score #}
                            {% set avg_bloom_level = clo_result.average_bloom_score %}
                        {% else %}
                            {% set normalized_clo = 0 %}
                            {% set avg_bloom_level = 0 %}
                            <!-- DEBUG: CLO {{ clo_idx + 1 }} - No clo_results data -->
                        {% endif %}
                        
                        {# Alt tablolardaki aralƒ±klara g√∂re performance ve recommendation belirleme #}
                        {% if normalized_clo >= 85 and avg_bloom_level > 3.0 %}
                            {% set performance_class = "perf-green" %}
                            {% set performance_text = "Very high achievement supported by sustained higher-order cognitive engagement" %}
                            {% set recommendation_text = "Maintain current instructional and assessment design; disseminate as internal benchmark practice" %}
                        {% elif normalized_clo >= 85 and avg_bloom_level >= 2 and avg_bloom_level <= 3 %}
                            {% set performance_class = "perf-green" %}
                            {% set performance_text = "High achievement primarily driven by mid-level cognitive processes" %}
                            {% set recommendation_text = "Increase assessment cognitive depth while preserving effective instructional structure" %}
                        {% elif normalized_clo >= 85 and avg_bloom_level < 2 %}
                            {% set performance_class = "perf-green" %}
                            {% set performance_text = "High scores driven by low-cognitive-demand tasks rather than deep understanding" %}
                            {% set recommendation_text = "Redesign assessments to emphasize application, analysis, and reasoning over recall" %}
                        {% elif normalized_clo >= 70 and normalized_clo < 85 and avg_bloom_level > 3.0 %}
                            {% set performance_class = "perf-yellow" %}
                            {% set performance_text = "Good achievement under cognitively demanding assessment conditions" %}
                            {% set recommendation_text = "Sustain cognitive rigor while strengthening instructional support mechanisms" %}
                        {% elif normalized_clo >= 70 and normalized_clo < 85 and avg_bloom_level >= 2 and avg_bloom_level <= 3 %}
                            {% set performance_class = "perf-yellow" %}
                            {% set performance_text = "Adequate to good achievement with appropriately balanced cognitive demand" %}
                            {% set recommendation_text = "Incrementally introduce higher-order tasks to extend learning beyond procedural competence" %}
                        {% elif normalized_clo >= 70 and normalized_clo < 85 and avg_bloom_level < 2 %}
                            {% set performance_class = "perf-yellow" %}
                            {% set performance_text = "Acceptable scores achieved through low-depth cognitive activities" %}
                            {% set recommendation_text = "Replace recall-focused questions with application- and analysis-oriented tasks" %}
                        {% elif normalized_clo >= 50 and normalized_clo < 70 and avg_bloom_level > 3.0 %}
                            {% set performance_class = "perf-orange" %}
                            {% set performance_text = "Limited achievement despite exposure to high-level cognitive demands" %}
                            {% set recommendation_text = "Enhance scaffolding, feedback, and conceptual clarity to support student success" %}
                        {% elif normalized_clo >= 50 and normalized_clo < 70 and avg_bloom_level >= 2 and avg_bloom_level <= 3 %}
                            {% set performance_class = "perf-orange" %}
                            {% set performance_text = "Partial achievement based on routine or procedural learning" %}
                            {% set recommendation_text = "Realign instructional delivery and assessment difficulty to improve outcome attainment" %}
                        {% elif normalized_clo >= 50 and normalized_clo < 70 and avg_bloom_level < 2 %}
                            {% set performance_class = "perf-orange" %}
                            {% set performance_text = "Minimal learning evidenced, restricted to recall or basic comprehension" %}
                            {% set recommendation_text = "Comprehensively revise teaching strategies and assessment design to promote deeper learning" %}
                        {% elif normalized_clo < 50 and avg_bloom_level > 3.0 %}
                            {% set performance_class = "perf-red" %}
                            {% set performance_text = "Failure to meet outcomes under cognitively demanding assessments" %}
                            {% set recommendation_text = "Rebuild foundational understanding and introduce progressive cognitive scaffolding" %}
                        {% elif normalized_clo < 50 and avg_bloom_level >= 2 and avg_bloom_level <= 3 %}
                            {% set performance_class = "perf-red" %}
                            {% set performance_text = "Low achievement even with moderate cognitive challenge" %}
                            {% set recommendation_text = "Intensify student support, adjust topic sequencing, and expand guided practice" %}
                        {% elif normalized_clo < 50 and avg_bloom_level < 2 %}
                            {% set performance_class = "perf-red" %}
                            {% set performance_text = "Severe learning deficiency with weak performance and low cognitive demand" %}
                            {% set recommendation_text = "Implement full instructional and assessment redesign as an immediate improvement priority" %}
                        {% else %}
                            {% set performance_class = "perf-gray" %}
                            {% set performance_text = "No data available for assessment" %}
                            {% set recommendation_text = "Please ensure all data is properly entered" %}
                        {% endif %}
                        
                        <tr{% if loop.index0 % 2 == 0 %} style="background-color: #f8f9fa;"{% endif %}>
                            <td style="font-weight: bold; color: #6f42c1; padding: 8px;">
                                {{ clo_names[clo_idx] if clo_names and clo_idx < clo_names|length else 'CLO ' ~ (clo_idx + 1) }}
                            </td>
                            <td class="perf-cell {{ performance_class }}">
                                {{ "%.2f"|format(normalized_clo) }}%
                            </td>
                            <td class="perf-cell {{ performance_class }}">
                                {{ "%.2f"|format(avg_bloom_level) }}
                            </td>
                            <td class="perf-cell {{ performance_class }}">
                                {{ performance_text }}
                            </td>
                            <td class="perf-cell {{ performance_class }}">
                                {{ recommendation_text }}
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>



        <!-- Information Tables Section - Hidden but logic remains in backend -->
        <!-- Tables are now hidden from UI but the interpretation logic continues to work in CLO Analysis Results -->

        <!-- Download CLO Analysis Results Button -->
        <div class="btn-group" style="margin-top: 20px; text-align: center;">
            <a href="/download_clo_analysis_csv" class="submit-btn" style="background-color: #28a745;">üì• CLO Analysis Results (CSV)</a>
        </div>

        <!-- Navigation Buttons -->
        <div class="btn-group" style="margin-top: 30px; text-align: center;">
            <a href="/student_grades" class="submit-btn" style="background-color: #6c757d;">‚Üê Back to Student Grades</a>
        
        </div>

    </div>
</body>
</html>
